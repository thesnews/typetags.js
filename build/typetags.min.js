/*! typetags 2015-11-13 */
!function(a){function b(b,c){this.element=b,this.settings=a.extend({},e,c),this._defaults=e,this._name=d,this.init()}var c=function(a){return _.unescape(decodeURIComponent(a))},d="typeTags",e={filter:function(a){for(var b=_.values(a[0].values),d=[],e=0;e<=b.length;e++){var f=b[e];f&&d.push({value:c(f.name_normalized),tokens:[c(f.name),c(f.name_normalized)]})}return d},beforePick:function(){},pick:function(){},field:"tags",container:!1,source:!1};b.prototype={init:function(){var b=a(this.element);this.settings.container=b.attr("data-container"),this.settings.source=b.attr("data-source"),a(this.settings.container).empty(),this.settings.field&&this.prePopulate();var c=this;a(this.settings.container).on("click",".tagsinput-remove-link",function(b){var d=a(b.currentTarget),e=d.parents("span.tag").first(),f=e.find("span").first();e.remove(),c.settings.field&&c.popTag(f.text())}),b.typeahead({name:this.settings.container.replace(/\./,""),limit:15,remote:{url:this.settings.source+"?q=%QUERY",filter:this.settings.filter}}).on("typeahead:selected",function(d,e){c.settings.beforePick.call(c);var f=a("<span></span>").addClass("tag").append(a("<span></span>").html(e.value+"&nbsp;&nbsp;")).append(a('<a class="tagsinput-remove-link"></a>'));a(c.settings.container).append(f),b.val(""),c.settings.field&&c.pushTag(e.value)}).on("keypress",function(d){if(13==d.keyCode){c.settings.beforePick.call(c);var e=a("<span></span>").addClass("tag").append(a("<span></span>").html(a(this).val()+"&nbsp;&nbsp;")).append(a('<a class="tagsinput-remove-link"></a>'));a(c.settings.container).append(e),c.settings.field&&c.pushTag(a(this).val());var f=a.Event("keydown");f.which=27,b.trigger(f),b.val("")}})},prePopulate:function(){var b=a(this.settings.field),c=b.val();if(c.length){c=c.split(","),a(this.settings.container).empty();var d=this;_.forEach(c,function(b){var c=a("<span></span>").addClass("tag").append(a("<span></span>").html(b+"&nbsp;&nbsp;")).append(a('<a class="tagsinput-remove-link"></a>'));a(d.settings.container).append(c)})}},pushTag:function(b){b=b.trim();var c=a(this.settings.field),d=c.val();d=d.length?d.split(","):[],d.push(b),this.settings.pick.call(this),c.val(d.join(","))},popTag:function(b){b=b.trim();var c=a(this.settings.field),d=c.val();d=d.length?d.split(","):[],_.remove(d,function(a){return a.trim()==b}),c.val(d.join(","))}},a.fn[d]=function(c){if(c&&"reset"==c){var e=a(this).data("plugin_"+d);e.prePopulate()}return this.each(function(){a.data(this,"plugin_"+d)||a.data(this,"plugin_"+d,new b(this,c))})}}(jQuery);