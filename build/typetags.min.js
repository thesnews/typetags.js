/*! typetags 2013-12-31 */
!function(a){a.fn.typeTags=function(){var b={filter:function(a){for(var b=_.values(a[0].values),d=[],e=0;e<=b.length;e++){var f=b[e];f&&d.push({value:c(f.name_normalized),tokens:[c(f.name),c(f.name_normalized)]})}return d},field:"tags"},c=function(a){return _.unescape(decodeURIComponent(a))},d=function(b,c,d){var e=a('[name="'+d+'"]'),f=e.val();f.length&&(f=f.split(","),_.forEach(f,function(b){var d=a("<span></span>").addClass("tag").append(a("<span></span>").html(b+"&nbsp;&nbsp;")).append(a('<a class="tagsinput-remove-link"></a>'));a(c).append(d)}))},e=function(b,c){b=b.trim();var d=a('[name="'+c+'"]'),e=d.val();e=e.length?e.split(","):[],e.push(b),d.val(e.join(","))},f=function(b,c){b=b.trim();var d=a('[name="'+c+'"]'),e=d.val();e=e.length?e.split(","):[],_.remove(e,function(a){return a.trim()==b}),d.val(e.join(","))};return arguments.length&&a.extend(b,arguments[0]),this.each(function(){var c=a(this),g=c.attr("data-container"),h=c.attr("data-source");b.field&&d(c,g,b.field),a(g).on("click",".tagsinput-remove-link",function(c){var d=a(c.currentTarget),e=d.parents("span.tag").first(),g=e.find("span").first();e.remove(),b.field&&f(g.text(),b.field)}),c.typeahead({name:g.replace(/\,/,""),limit:15,remote:{url:h+"?q=%QUERY",filter:b.filter}}).on("typeahead:selected",function(d,f){var h=a("<span></span>").addClass("tag").append(a("<span></span>").html(f.value+"&nbsp;&nbsp;")).append(a('<a class="tagsinput-remove-link"></a>'));a(g).append(h),c.val(""),b.field&&e(f.value,b.field)}).on("keypress",function(d){if(13==d.keyCode){var f=a("<span></span>").addClass("tag").append(a("<span></span>").html(a(this).val()+"&nbsp;&nbsp;")).append(a('<a class="tagsinput-remove-link"></a>'));a(g).append(f),b.field&&e(a(this).val(),b.field);var h=a.Event("keydown");h.which=27,c.trigger(h),c.val("")}})})}}(jQuery);